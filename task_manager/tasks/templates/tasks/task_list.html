{% extends 'tasks/base.html' %}
{% block content %}

<h2>Task List</h2>

<!-- Task Creation Form -->
<form method="POST">
    {% csrf_token %}
    
    <label>Title:</label> {{ form.title }}
    <label>Description:</label> {{ form.description }}
    <label>Priority:</label> {{ form.priority }}
    <label>Due Date:</label> {{ form.due_date }}
    <label>Completed:</label> {{ form.completed }}

    <!-- Categories Selection -->
    <label>Categories:</label>
    <div>
        {% for category in form.categories %}
            <label>
                {{ category.tag }} {{ category.choice_label }}
            </label>
        {% endfor %}
    </div>

    <!-- New Category Input -->
    <label for="new_category">Create New Category:</label>
    <input type="text" name="new_category" id="new_category" placeholder="Enter new category">

    <button type="submit">Add Task</button>
</form>

<hr>

<!-- Display Tasks -->
<ul>
    {% for task in tasks %}
    <div>
        <h3>{{ task.title }}</h3>
        <p>{{ task.description }}</p>
        <p>Priority: {{ task.priority }}</p>
        <p>Due Date: {{ task.due_date }}</p>
        <p>Status: {% if task.completed %} ✅ Completed {% else %} ⏳ Pending {% endif %}</p>
        
        <!-- Show Assigned Categories -->
        <p>Categories: 
            {% for category in task.categories.all %}
                <span>{{ category.name }}</span>{% if not forloop.last %}, {% endif %}
            {% empty %}
                <span>No categories</span>
            {% endfor %}
        </p>

        <a href="{% url 'edit_task' task.id %}">Edit</a> |
        <a href="{% url 'delete_task' task.id %}">Delete</a>
    </div>
    {% empty %}
        <p>No tasks available.</p>
    {% endfor %}
</ul>

{% endblock %}
